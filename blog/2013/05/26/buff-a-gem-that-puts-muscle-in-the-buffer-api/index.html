
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Buff - A Gem that Puts Muscle in the Buffer API - Civet</title>
	<meta name="author" content="Zander">

	
	<meta name="description" content="Buff - a Gem That Puts Muscle in the Buffer API It&#8217;s Done! Buff is a Ruby Gem that wraps the Buffer API. Why Write Buff Gem from Scratch? &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Civet" type="application/atom+xml">
	
	<link rel="canonical" href="http://zph.github.io/blog/2013/05/26/buff-a-gem-that-puts-muscle-in-the-buffer-api/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("zander@civet.ws") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Civet</a></h1>
  
    <h2>The Spice of Life</h2>
  
</hgroup>

<p class="subtitle">The Spice of Life</p>
<nav id="main-nav">
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/_ZPH" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/ZPH" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Buff - a Gem That Puts Muscle in the Buffer API</h1>
	<div class="entry-content" itemprop="articleBody"><p>It&#8217;s Done!  <a href="http://github.com/zph/buff">Buff</a> is a Ruby Gem that wraps the <a href="http://bufferapp.com">Buffer</a> API.</p>

<h2>Why Write Buff Gem from Scratch?</h2>

<p>Because the current Buffer Gem doesn&#8217;t have full coverage for the API.  I started to update the Buffer Gem but quickly realized that I was spinning my wheels.  I wanted to implement the gem as a set of layered abstractions and to be able to process the responses using Hashie::Mash.  I envisioned a Gem where each response was a first class Ruby object, where each nested key could be called as a method.</p>

<p>I realized that it would be cleaner and more expedient to code from scratch: I spent the next few hours and produced a gem that had feature parity with Buffer&#8217;s existing gem:</p>

<p>Introducing <a href="http://github.com/zph/buff">Buff</a>, the API complete Ruby Wrapper for <a href="http://bufferapp.com"> BufferApp.com. </a> Buff muscles Ruby into Buffer&#8217;s API.</p>

<h4>Buff is RSpec tested, Webmocked, Travis CI&#8217;d, and easy to use.</h4>

<script src="https://gist.github.com/zph/5654310.js"></script>

<h2>Setbacks and Triumphs</h2>

<p>It wasn&#8217;t all roses and perfume in the creation of this gem.   Three setbacks stand out in my mind.</p>

<h3>Webmock</h3>

<p>I&#8217;ve previously used VCR for testing web APIs, but wanted to use a new system to build new skills.  Webmocks are very pleasant to use and allowed the Specs to verify what API was contacted, along with testing the body content and return values.</p>

<h3>HTTP Libraries</h3>

<p>Buff Gem started with <strong>HTTParty</strong>, which was splendid while implementing the [cci]HTTP GET API[/cci] methods.  Once I began implementing the [cci]HTTP POST[/cci] requests I started experiencing discomfort with using <strong>HTTParty</strong>.  It&#8217;s a reliable library but I didn&#8217;t gel with the DSL for describing HTTP requests.  Thankfully the <strong>HTTParty</strong> calls were wrapped inside the [cci]post[/cci] and [cci]get[/cci] methods in [cci]Buff::Client::Core[/cci].</p>

<p>Since the code was tested with Rspec and the post and get methods were abstracted, swapping out <strong>HTTParty</strong> for <strong>Faraday</strong> was merely a one hour setback.</p>

<p>What a wonderful confirmation that it&#8217;s valuable to wrap external library calls in an abstraction method inside your own library.  This made dependency swaps much simpler.</p>

<h3>Creating correct &#8220;application/x-www-form-urlencoded&#8221; Data</h3>

<p>I expected to find a Standard Library tool for converting a nested Hash + Array object into www-form-encoded data.  I was sorely disappointed, looking at you Addressable Gem, and spent hours trying to find an already coded solution.</p>

<p>After stepping back from the code for two days, I was explaining the problem to non-technical coworkers.  In that moment, my subconscious presented the answer.  I realized how easily I could write the transformation myself.  I mentally coded it on the way home that afternoon and wrote it in bytes that evening.  Here&#8217;s the implementation from [cci]Buff::Client::Encode[/cci]:</p>

<script src="https://gist.github.com/94a89ea5abcfa6f60ee1.js"></script>

<p><strong>Moral of the story</strong>: When stumped, back off and solve another problem.  The subconscious is a useful ally.  Hours of struggling could have been saved through patience and getting other things done.</p>

<h2>What&#8217;s Next?</h2>

<p>Since the Buff Gem provides greater coverage of the Buffer API than the existing Gem, it&#8217;d be awesome to see it replace Buffer Gem as the official Ruby Wrapper.</p>

<p>I feel great about completing a Gem with 100% coverage of an HTTP API :).</p>

<p>I&#8217;m considering writing a couple of small Buffer CommandLine tools for easy posting.  If I have more steam, I&#8217;ll add an Alfred Workflow on top that allows posting to Buffer!</p>

<h2>Want a Demo of Using Buff inside Pry?</h2>
<iframe src="http://showterm.io/1b512291be06a620e4bc6#fast" width="640" height="480"></iframe>
<h2>PS</h2>

<p>If you work with <a href="http://bufferapp.com"> Bufferapp </a> and want to adopt this Gem as your Official Ruby Wrapper, that would be snazzy.  Let&#8217;s talk: <a href="http://twitter.com/_ZPH">@_ZPH</a> or <a href="mailto:zander@civet.ws">Zander</a>!</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner"><p class="pull-left">
  <a href="/">Civet</a>
  - Copyright &copy; 2013 - Zander
</p>
<p class="pull-right">
  <span>Powered by <a href="http://octopress.org/">Octopress</a>.</span>
  
    <span>Designed by <a href="http://www.AdrianArtiles.com">Adrian Artiles</a>.</span>
  
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->













  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



		</div>
	</div>
</body>
</html>
