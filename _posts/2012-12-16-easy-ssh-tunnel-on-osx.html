---
layout: post
title: Easy SSH Tunnel on OSX
tags:
- DNS
- open wifi
- OSX
- Squid Proxy
- SSH
- Technology
- VPS
- Wi Fi
- WIFI
status: publish
type: post
published: true
meta:
  bfa_virtual_template: hierarchy
  _edit_last: '1'
  dsq_thread_id: '1050306171'
  image: ''
  _yoast_wpseo_linkdex: '0'
  _yoast_wpseo_focuskw: ''
  _yoast_wpseo_title: ''
  _yoast_wpseo_metadesc: ''
  _yoast_wpseo_meta-robots-noindex: '0'
  _yoast_wpseo_meta-robots-nofollow: '0'
  _yoast_wpseo_meta-robots-adv: none
  _yoast_wpseo_sitemap-include: ! '-'
  _yoast_wpseo_sitemap-prio: ! '-'
  _yoast_wpseo_canonical: ''
  _yoast_wpseo_redirect: ''
  _yoast_wpseo_opengraph-description: ''
  _yoast_wpseo_google-plus-description: ''
  _clicky_goal: a:2:{s:2:"id";s:0:"";s:5:"value";s:0:"";}
---
I recently found myself working from a restaurant with open WIFI. After having someone on open WIFI snatch my Facebook credentials back in 2009, I've become understandably paranoid about security on unsafe connections.

I spent a few minutes setting up a Squid Proxy on my VPS, when I came upon a better solution: set a SOCKS Proxy in OSX and create an SSH tunnel.
<h1>How it works</h1>
The SSH tunnel connects to the VPS using an encrypted channel. This is open for use on a localport such as 8080 (or a randomly assigned one w/ script).
The SOCKS Proxy passes network requests to the localport instead of sending them to the web/email-server/etc.
<h1>How to do it</h1>
On OSX it consists of the two following steps:
[cc_bash]sudo networksetup -setsocksfirewallproxy Wi-Fi 127.0.0.1 $localport off[/cc_bash]
[cc_bash]ssh -f -p $remoteport -D $localport $remoteuser@$remoteproxy sleep 1d[/cc_bash]

This is all well and good, but someone went to the trouble of wrapping this in a script: <a href="https://github.com/12k/osx-proxy">OSX-PROXY</a>.

I took a little bit of time this weekend and refactored the code to extract functions, utilize a case statement, and add extra commandline arguments.

&nbsp;

My revised script also toggles the state of the proxy if no arguments are given.
<h2>Update</h2>
The aforementioned code works very well but I'm not sure if it re-routes all DNS requests which could divulge personal information. So I switched to this python library that re-routes all activity and is more established: <a href="https://github.com/apenwarr/sshuttle">SShuttle</a>.

Add an alias to the shell for quick starting with default settings: [code]alias sshuttle_start='<code>sshuttle --dns -vvr user@vps 0/0'</code> [/code](Replace user and vps placeholders with the appropriate info).

PS - Never ever trust public or semi-public Wifi.  Using a proxy like this is the minimum security that you should consider.

<!-- #VIMREPRESS_TAG# http://198.211.104.146/wp-content/uploads/2012/12/vimrepress_50ceaa05_mkd.odt vimrepress_50ceaa05_mkd.odt -->
